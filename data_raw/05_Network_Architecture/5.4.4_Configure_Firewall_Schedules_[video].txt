Transcript




close interactive script
Click one of the buttons to take you to that part of the video.
1. Configure Firewall Schedules
00:03
There may be times when you want to restrict certain
00:06
groups of users' access to the internet or other services.
00:09
For example, you might allow SSH through the
00:11
firewall to a Linux server, but the person who
00:14
needs access to it only has it during work hours.
00:18
Another example is a school that doesn't want
00:20
normal users accessing the web after hours.
00:24
There are many cases when you'd
00:25
want to configure restrictions.
00:27
For our demo, we're going to use a scenario of blocking
00:30
web traffic, or HTTP traffic, after business hours.<br>
2. Set a Schedule
00:35
This is basically a three-part process.
00:37
First, we'll create a time-restriction schedule.
00:40
Then we're going to create a rule
00:43
and apply that schedule to our users.
00:45
The last thing we'll do is create a rule to override
00:49
the restriction for members of our management group.<br>
00:52
So, under Firewall &gt; Schedules,
00:54
I go over to Add and click on it.
00:57
I need to give it a Schedule Name.
00:59
This can't have any spaces in it, so I'll use
01:01
underscores and call it Allow_Web_Work _Hours.
01:05
For our Description we can use anything.
01:07
I'll call it Allow Web During Work Hours.<br>
01:12
For the days, I'll click on the workdays of
01:14
Monday through Friday to add all of them.
01:17
For Time, I'll pick 7:00 a.m.
01:19
from the dropdown list and jump over to Stop Hours.
01:22
Here, I'll pick 17 and leave the minutes at 59.
01:26
That makes our stop time 5:59 p.m.
01:29
I'll click on Add Time, and you can see my Configured Range
01:33
here, which is now Monday through Friday from 7:00 a.m.
01:36
to 17:59.
01:38
That looks good, so let's click Save.
01:41
Now we're done with our schedule.
01:42
Next, we need to configure our firewall rules.<br>
3. Apply Schedule to Firewall Rule
01:45
We now need to go up to Firewall &gt; Rules and then
01:49
click on our LAN tab to get to our LAN firewall rules.
01:53
We have a few rules.
01:54
One basically allows IPv4 out to
01:57
anywhere and the same for IPv6.<br>
01:59
We want to add our rule to the top of the list.
02:02
So I'll pick Add with the arrow pointing up.<br>
02:05
We want to select Block because we're going
02:08
to block traffic based on the schedule.
02:10
I'll scroll down.<br>
02:12
We're going to block everything on our LAN network,
02:15
so I'll pick LAN net from the dropdown list.
02:18
I need to click on the Display Advanced button here.
02:21
Now, for our Source Port Range
02:24
we want to block HTTP port 80.<br>
02:27
Let's scroll down a bit.
02:29
Under Extra Options, click on Display
02:32
Advance to see additional options.
02:33
We need to come down and find where it says Schedule.
02:36
From the list, we have all our schedules.
02:39
And since we only created one, that's all we have.
02:42
Let's pick that one.
02:43
Go down and click on Save.<br>
02:46
Now we see our new rule.
02:48
The source is the LAN network on port 80.
02:51
Over here, you can see that it refers
02:53
to the schedule that we created.
02:55
This all looks good, and so we
02:57
go up and click Apply Changes.<br>
4. Create Aliases
02:59
We have our schedule and we've created a
03:02
rule that applies that schedule to our users.
03:04
But what about users that we want to have access
03:07
to the internet no matter what time of day it is?
03:09
We need to create another rule for that.
03:12
But first we need to create an alias.
03:15
An alias is a group of IPs that'll be grouped together.
03:19
That alias will be added to a
03:21
rule that allows internet access.<br>
03:23
To do that, we go up to Firewall &gt; Aliases.
03:27
When the page loads, we go down to the Add button.
03:30
We need to give it a name that we'll use
03:32
to identify this group of IP addresses.
03:34
We'll just say that this group is our management.
03:37
So, for the Name field that's what I'll put in.
03:39
I'll do the same for Description.<br>
03:42
Now I need to enter in the IP addresses of
03:45
those devices that'll be part of this alias.
03:47
I'll enter in a few and start with 10.10.10.1.
03:51
That IP belongs to Dana.
03:53
Click Add Host.
03:55
Now let's enter 10.10.10.2; that'll be Jon's.
04:02
Click Add Host and we'll add one more, which is 10.10.10.3.
04:06
That'll be for Mary.
04:08
Click Add Host one final time and then click Save.
04:14
Apply the changes and we're ready to create our final rule.<br>
5. Create Override Rule
04:18
Now that we have our alias, we need to create our rule to
04:21
override the rule that blocks web access for all users.
04:26
These rules will be from the top down.
04:28
If our firewall reads the first rule that says to block all
04:32
HTTP traffic during non-work hours, that rule is applied.
04:37
The rule that says to allow
04:38
management access will never be seen.
04:41
So, we need to make sure that we tell our
04:43
firewall that our management can have access
04:46
before we tell it to block everyone else.
04:49
We go to Firewall &gt; Rules &gt; LAN and then
04:53
click the Add button with the up arrow.<br>
04:57
All the settings here are fine.
04:59
But down here, under Source, we need
05:01
to change this to Single host or alias.
05:04
Now, watch as I start to type in the address field.
05:07
As soon as I start to type in Management,
05:10
it auto-populates with our alias.
05:12
We'll leave the destination set to Any.
05:15
For Description, I'll type in Allow
05:17
Management Web Access Anytime.
05:22
Click on Save and the rule is created.<br>
05:25
As a quick side note, this first rule
05:28
is created automatically by pfSense.
05:30
It's there to prevent you from creating any rule that might
05:33
accidently block you from gaining access to the firewall.
05:36
That's why it's first in this position.
05:38
You can actually remove that rule,
05:40
but that's not part of this lesson.
05:42
Right below that is our rule.
05:44
The rule we create for management will be
05:46
applied before the block web access rule.
05:49
The one right below it is applied.<br>
6. Summary
05:52
That's it for this demo.
05:53
In this demo, we created a schedule on our
05:55
firewall to deny web access to our users.
05:59
Then we created an alias for a group of users who
06:02
are allowed to bypass that rule with a second rule.<br>