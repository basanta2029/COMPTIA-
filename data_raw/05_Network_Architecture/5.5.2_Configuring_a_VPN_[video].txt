Transcript




close interactive script
Click one of the buttons to take you to that part of the video.
1. Configuring a VPN
00:04
In this demonstration, we're going to cover how to
00:07
configure OpenVPN on a pfSense security appliance. We're
00:11
already logged into pfSense on the Dashboard page.
2. Install OpenVPN Client Export Package
00:13
The first thing I'm going to do is to go to System
00:17
> Package Manager and select Available Packages.
00:21
I'm going to type in ‘openvpn' to search
00:24
for the OpenVPN Client Export package.
00:27
This will allow us to export our configuration
00:29
settings to make setting up our clients a lot easier.
00:33
Click Install and Confirm.
00:35
This will take about a minute or so to install.
00:43
Now let's confirm the installation.
00:45
Success.
3. Configure OpenVPN Server Type
00:49
Now let's go over to VPN > OpenVPN.
00:52
We'll select Wizard to get started.
00:55
In the past, setting up a VPN was a bit complicated, but
00:58
the wizard makes setting up OpenVPN really quick and easy.
01:02
For the type of server, we're
01:04
going to select Local User Access.
01:06
We could also pick LDAP or RADIUS if
01:08
you have those set up, but we don't.
01:11
Click Next to continue.
4. Configure OpenVPN Certificate
01:13
Now we need to create a certificate authority.
01:16
pfSense adds this right in the wizard so you don't
01:19
have to do it manually somewhere else, which is nice.
01:22
For the Descriptive name, I'll just enter in "TestoutCA".
01:26
I'll leave these next few fields at the
01:28
default values and go down to Country Code.
01:31
Here, I'll enter ‘US'.
01:33
For State or Province, I'll enter ‘UT' for Utah.
01:36
For City, I'm in the wonderful town of ‘Pleasant Grove'.
01:40
For Organization, I'll put ‘TestOut'.
01:42
Now click on Add new CA to add the
01:45
Certificate Authority to the server.
01:47
Now we must create a new server certificate.
01:50
We just added the Certificate Authority.
01:53
Next, we need an actual certificate.
01:55
For Descriptive name, I'll just put ‘Testout'.
01:58
I'll leave everything with the default values.
02:01
Country Code, State, City, and Organization are
02:05
all auto-populated with the correct answers, so
02:07
I'll just click on Create new certificate.
5. OpenVPN Setup
02:10
Now let's configure the server information.
02:13
For our interface, we want to select our WAN.
02:16
We also have LAN and DMZ.
02:19
Our WAN is where traffic will typically come from.
02:21
Our Protocol will be UDP on IPv4 only.
02:26
You can see we have some other choices in
02:28
case your setup is different from mine.
02:31
Our VPN uses the default port of 1194.
02:35
We'll enter a description for our
02:37
VPN and just call it ‘TestoutVPN'.
02:39
We'll leave all the cryptographic settings set to
02:42
their defaults and skip down to Tunnel Settings.
02:46
The first thing we must do is enter some
02:48
virtual network settings for our tunnel network.
02:50
This will be a virtual network that our
02:53
clients and server will use to communicate on.
02:56
I'm going to enter '10.10.20.0/24'.
03:02
All my VPN clients will get an IP address of
03:05
10.10.20.something with a subnet mask of 255.255.255.0.
03:12
Next is our local network.
03:14
This is the LAN network that your VPN clients will access.
03:18
My local LAN network is '10.10.10.0/24'.
03:23
For concurrent connections, I'll just put in 5.
03:26
You can enter more or less than that.
03:28
It just depends on how many VPN users
03:30
you'll have connecting at one time.
03:33
Now, once your users connect, they'll need a DNS server.
03:37
You could put in a public DNS or local DNS.
03:41
I'll put in the DNS that my LAN uses, which is '10.10.10.1'.
03:46
This is also the IP address of my pfSense appliance.
03:50
Scroll down and click Next.
6. Firewall Rules
03:52
Now we need to set up two firewall rules.
03:55
We need to allow traffic from our
03:57
VPN clients to our VPN server.
03:59
We also need to allow traffic from our
04:01
clients through the VPN to our network.
04:05
Lucky for us, we don't have to do this manually.
04:07
OpenVPN understands what we need, and by checking
04:11
these boxes, OpenVPN will configure those rules for us.
04:15
Configuring rules is not part of this lesson,
04:17
but they're certainly a skill you need to know.
04:20
Click Next to continue.
04:21
And on this page, click Finish.
04:24
Let's review what we've done.
04:26
We have our interface set to WAN.
04:28
Our protocol and port are set to UDP on port 1194.
04:33
Our tunnel network looks good.
04:35
Our encryption is here.
04:36
And our description is TestoutVPN.
7. Add an OpenVPN User
04:39
Now let's head over to System >
04:42
User Manager and click on Add.
04:45
I really don't want my admin user to be the
04:48
same as one of my VPN users, so I'm going to add
04:51
a different user here to keep them separate.
04:54
For the username, I'll enter ‘danafellows'.
04:57
I'll enter my password and confirm it.
05:00
I'll just put Dana for the full name.
05:02
Click Save.
05:02
Everything looks good, and that's all I need to do here.
8. Confirm Server Access Mode
05:07
I'll go back up to VPN > OpenVPN, come
05:11
down here, and click on the edit icon.
05:13
For some reason, our server mode changes to Remote Access
05:17
SSL plus TLS, but we're using Remote Access (User Auth),
05:21
so we need to confirm that and change it back if needed.
05:25
It looks like we do, in fact, need to change that.
05:28
I'll scroll down to the bottom and click on Save.
9. Client Download
05:31
Now it's time to download the client configuration.
05:34
We'll go to Client Export.
05:36
On the next page, scroll down to our list
05:39
of OpenVPN client configuration options.
05:42
I'll find the one for the Windows Installer and
05:44
click on it to download the configuration file.
05:47
Now I'll copy this over to a machine I have on a
05:50
different network and install the OpenVPN client.
10. Install and Run OpenVPN Client
05:54
I'm now on a machine on my DMZ network.
05:57
I copied the installation file
05:59
over, and I'll install it now.
06:01
I'll click Yes to the User Access Control, click
06:04
Install to continue, and click through all the rest
06:07
of these to complete the installation process.
06:11
Click Finish, and finally, click Close.
06:15
Now let's double-click to start the OpenVPN client.
06:18
I'll drag the installation files into the Recycle Bin.
06:22
I'll move the OpenVPN client, here on the
06:24
taskbar, to a spot where we can see it better.
06:27
Right-click on it and choose Connect.
06:30
My username is automatically populated, so I'll just
06:33
enter in my password and check the Save password box.
06:36
Click OK to connect.
06:38
I get a message that I'm connected,
06:40
and my Assigned IP is listed here.
06:43
Now, if you're like me, you might ask yourself,
06:45
"How did the client know how to connect to my
06:48
OpenVPN server out there on the internet?" Let's
06:51
take a second to look at the config file.
06:52
I'll right-click and select Edit Config to open it.
06:57
It opens in a text file, and here are all
06:59
the settings that were configured for us.
07:02
Down here is the IP address of the WAN interface.
07:05
Now, you might say, "Hey, that's a private IP address."
07:09
Yes it is.
07:10
This is a test network, so I'm actually
07:12
using a private IP range for my WAN.
07:14
Let's take a look at that for a minute.
07:16
Here's a diagram of my test network.
07:19
I accessed my pfSense and OpenVPN
07:22
settings from this client, over here.
07:24
The configuration is actually here, on the pfSense.
07:28
The client over on my DMZ network is the one that
07:32
initiated the connection to the VPN just a second ago.
07:35
This client can be anywhere on the internet,
07:38
but for demo purposes, I placed it on my DMZ.
07:41
Now let's just confirm a few final things before we wrap up.
11. Confirm That OpenVPN is Connected
07:46
I'm still on my client on my DMZ.
07:49
I'm going to open a command prompt to check my IP settings.
07:52
I'll do an ‘ipconfig /all' and press Enter.
07:56
I'll scroll up a bit.
07:57
Here's the IP address of this
07:59
machine on the DMZ, 172.16.1.101.
08:04
That is my IP scheme for the DMZ.
08:07
Now let's scroll down a bit.
08:09
Remember, we made our tunnel network 10.10.20.0, and right
08:14
here is an address from that range that's assigned to us.
08:17
We saw that a few minutes ago,
08:19
also right after we connected.
08:22
One final thing.
08:23
I access the pfSense configuration through a web browser.
08:27
I have it blocked from being accessed externally.
08:30
But since we're connected to the LAN through
08:32
this VPN, let's see if we can access it.
08:35
I'll open my browser, and in the Address field, I'll enter
08:38
the IP of the pfSense with the LAN address of 10.10.10.1.
08:44
When I do that, the Sign In page is displayed,
08:46
confirming that I have access to LAN resources.
12. Summary
08:49
That's it for this demo.
08:50
We configured OpenVPN on pfSense.
08:54
We installed the client configuration package, set up
08:57
our certificate, configured OpenVPN server settings,
09:00
created a user, downloaded and installed the OpenVPN
09:04
client on a remote host, and confirmed our connection.