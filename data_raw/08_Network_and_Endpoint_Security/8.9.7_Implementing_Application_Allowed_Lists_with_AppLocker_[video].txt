
Transcript




close interactive script
Click one of the buttons to take you to that part of the video.
1. Implementing Application Deny and Allow Lists with AppLocker
00:04
In this demonstration, we'll practice implementing
00:07
application deny and allow lists using AppLocker.
00:09
AppLocker is a very useful feature of Windows.
00:14
It allows you to control what applications are allowed
00:16
or not allowed to run on machines in your domain.<br>
00:20
As a real-world example of why you might do this, I had a
00:23
junior administrator once that ran some registry cleaning
00:25
software on a production SQL server, and it damaged SQL.
00:31
The database would still run, but I was not
00:33
able to upgrade it to a newer version of SQL.
00:36
After I set up a new SQL server and got the
00:38
database moved over and functioning, I took
00:41
the time to set up some AppLocker rules.
00:44
I downloaded every registry cleaning software I could find
00:46
and made Deny rules in AppLocker, so no one would ever be
00:50
able to run a registry cleaner on a production server again.<br>
00:54
You can use it to accomplish such things as
00:56
preventing malware from being installed, preventing
00:59
unsupported applications from being installed.<br>
2. Whitelist an Application
01:02
The process of implementing application
01:04
block and allow lists is fairly complex.<br>
01:07
First, you must implement the rules for executable files.
01:11
Then, you test those rules to verify that they are
01:14
working as you expect without negatively affecting users.<br>
01:19
After you analyze events created by AppLocker,
01:22
you can then modify the rules and enforce them.<br>
01:25
Let's begin with the first step
01:26
of defining the executable rules.
01:29
In this scenario, we'll enforce the
01:31
AppLocker policy settings using Group Policy.<br>
01:34
By doing this, anytime a user logs into the domain,
01:38
the AppLocker settings are automatically enforced.
01:41
Let's open the Group Policy Manager.<br>
01:44
The default domain policy would be a bad
01:46
choice of Group Policy objects (GPOs) to use.
01:50
Improperly configured Applocker rules can
01:52
render your system completely inoperable.
01:55
If you put your rules in the Default Domain Policy
01:58
and they don't work as expected, you're going to
02:00
cause widespread problems across your whole domain.
02:04
So, let's create a new GPO called Applocker.
02:05
Let's right-click it and select Edit.
02:16
We're going to resize this screen so we
02:18
can see what's going on a little better.<br>
3. Configure Rule Enforcement
02:30
Under Computer Configuration, we'll expand
02:31
Policies &gt; Windows Settings &gt; Security
02:32
Settings &gt; Application Control Policies.<br>
02:39
When we expand AppLocker, we can see these
02:41
sets of application rules we can use.
02:44
Let's select AppLocker and click Configure rule enforcement.<br>
02:46
For our purposes today, we'll focus on Executable rules.
02:52
We'll select the Configured checkbox here.
02:55
After that we need to define whether we want
02:57
to enforce those rules or just audit them.<br>
03:00
We'll choose to audit only for now.
03:02
You could immediately enforce the rules if you
03:04
wanted, however, in a production environment you
03:07
want to make sure that the rules you define work
03:09
properly for the end users in the organization.<br>
03:13
When we select Audit, the events are generated by
03:16
AppLocker and we can access those in Event Viewer.
03:19
We can analyze Event Viewer events to
03:21
decide whether the rules are working
03:23
correctly or whether we need to modify them.<br>
4. Create a New Rule
03:25
Let's go to Executable Rules.
03:29
Notice that there are no rules here.
03:31
We're enforcing them, but there are no rules to enforce.
03:34
So, let's right-click here and select Create New Rule.<br>
03:39
In the Before You Begin screen, it tells you how the
03:42
rule works and some preparatory steps you need to follow.<br>
03:45
For example, you need to make sure that the applications you
03:48
want to create the rule for are installed on this system.
03:51
We've already done that.
03:53
There are other steps, but we
03:54
don't need to worry about them.
03:56
Let's click Next.<br>
5. Set Permissions
03:58
Now we have to specify the action
03:59
to be used in the AppLocker rule.
04:02
As noted up here, an allow action
04:04
permits the affected files to run.<br>
04:06
A deny action, on the other hand,
04:08
prevents the files from running.
04:10
We want to use an Allow rule.
04:12
Another thing we do on this page is
04:14
specify who this rule applies to.<br>
04:17
The application we are allowing is called SalesBuilder.
04:20
It's used by the Sales department.
04:22
As such, we want this rule to apply only to the Sales group.<br>
04:27
So, let's specify that this rule applies
04:29
to the Sales group by clicking Select.
04:31
We'll type in Sales and click Check Names.
04:35
Windows has found the group, so we'll click OK.
04:38
Click Next.<br>
6. Specify Conditions and Path
04:40
At this point, we need to specify the primary
04:42
condition that will be used in the rule.
04:44
We have three options.
04:46
We'll use the Path option.<br>
04:49
We would use the Publisher option if the application we
04:51
want to create the rule for is signed by a known software
04:54
publisher, but since ours is an in-house application that
04:57
isn't signed, we can't' use that option.
05:00
Let's click Next.<br>
05:02
Now we need to specify the path to the application.
05:05
We'll click Browse Folders and let's browse
05:07
to the folder where the executable resides.
05:09
It's SalesBuilder; select it.
05:13
Notice that we have two options for specifying a path.<br>
05:16
We can specify a file or specify a folder.
05:20
Because we want the rule to apply to all files in the
05:22
SalesBuilder folder, we specified a folder instead of a file.
05:26
Click Next.
05:28
We don't want to create any exceptions.
05:31
The default rule name isn't very friendly, so I'm
05:33
going to give this rule a more descriptive name.<br>
7. Create Default Rules
05:40
Notice that we're presented with this dialogue here.
05:42
It tells us that we've created a custom rule, but
05:45
there are default rules that should be created so that
05:47
important system files will still be able to be run.<br>
05:51
If you don't create these default rules, you may not
05:54
be able to run most of the applications that you need.
05:57
Let's create the default rules along with
05:59
the rule we just defined by clicking Yes.<br>
06:01
And there you go.
06:03
Notice that the default rules allow basically full
06:05
access to anyone in the administrator's group.<br>
06:07
The Everyone group is allowed access to all files located
06:12
in the Windows folder and it is also allowed access to
06:15
files that are installed in the Program Files folder.<br>
06:19
We had to create this custom rule because SalesBuilder
06:21
is not installed in the Program Files folder.
06:24
It's installed in the root directory of the C: drive.
06:27
We created a special rule that allows
06:29
the Sales group to run the application.<br>
8. Start Application Identity Service Automatically
06:32
It's important to know that the rules we just
06:34
configured won't be applied to any users who are
06:36
currently logged in while we defined these rules.<br>
06:39
The rules won't take effect until those users log out and
06:42
log back in, or until you run GPUpdate on the workstation.<br>
06:45
Now, it's important to note that AppLocker uses the
06:48
Application Identity service on individual
06:51
workstations to verify the attributes of the
06:54
executable files we specified in our executable rules.
06:57
Therefore, we need to make sure that the Application
07:00
Identity service is always started by default.
07:03
We can do this using Group Policy.<br>
07:06
By doing this when the user logs into the domain, we
07:09
enforce the AppLocker rules and we make sure that the
07:11
Application Identity service automatically runs as well.<br>
07:15
So, let's edit our AppLocker policy again.
07:18
We'll go to Computer Configuration &gt; Policies
07:20
&gt; Windows settings &gt; Security Settings.<br>
07:20
Under Security Settings let's select System Services.
07:26
Over here in the right pane, we'll
07:26
right-click Application Identity.
07:29
And then we'll define this to start automatically.
07:35
Click OK.<br>
07:37
With the rules configured and the Application
07:39
Identity service starting automatically, we
07:41
can test our AppLocker policy.
07:44
We can have end users log in to the domain,
07:46
run the application as they normally would,
07:47
and then we analyze the AppLocker events.<br>
07:51
Based on what we see in Event Viewer, we would decide
07:54
whether the rules we set up are functioning correctly.
07:56
If they are, we can enforce the policy.
07:59
If not, we would go in and modify
08:00
the policy to work the way it should.<br>
9. Summary
08:03
That's it for this demonstration.
08:05
In this demo, we implemented application
08:07
block and allow lists with AppLocker.<br>